<?phpif(isset($_COOKIE['ses_id'])){    session_id($_COOKIE['ses_id']);}session_start();$_SESSION['userContext'] = 'log';if(!isset($_SESSION['userName'])){    header('Location: signIn.php');}elseif(!isset ($_SESSION['pass'])|| !isset ($_SESSION['location']) || $_SESSION['pass']!=TRUE){ // || !isset($_GET['latitude']) || !isset($_GET['longitude'])    header('Location: index.php');}elseif(!isset($_GET['latitude']) || !isset($_GET['latitude'])){    header('Location: signIn.php');}else{require '../php/globals.php';$dbLocation = new locationDB();$locationName = $dbLocation->getLocationName($_SESSION['location']);@$latitudeAD = ($_GET['latitude']) ? $_GET['latitude'] : '';@$longitudeAD = ($_GET['longitude']) ? $_GET['longitude'] : ''; $formatted_address = '';$dbJobs = new jobDB();$theJobs = new jobs();$aJob = new job();$theJobs = $dbJobs->getOpenJobsEmployeeLocation($_SESSION['userId'],$_SESSION['location']);$openJobs = $theJobs->getCount();$jobDdId = "";if($openJobs == 0){    $aJob->setEmployeeId($_SESSION['userId']);    $aJob->setLocationId($_SESSION['location']);    $aJob->logStartTime();        $aJob->setlatt($latitudeAD);        $aJob->setlng($longitudeAD);          $dbJobs->addJob($aJob);        $action = 'New';        $uid = $_SESSION['userId'];    $loc = $_SESSION['location'];}else{            $aJob = $theJobs->getFirstIndexJob();        $aJob->logEndTime();        $aJob->setlatt($latitudeAD);        $aJob->setlng($longitudeAD);        $aJob->logEndTime();                $url = "http://maps.googleapis.com/maps/api/geocode/json?latlng=".trim($latitudeAD).",".trim($longitudeAD)."&sensor=false&key=AIzaSyCILcMm9IgtncqBw9GBWgvLrJtBaVH77yY";                $json = @file_get_contents($url);                $data=json_decode($json);                    $status = $data->status;                if($status=="OK"){            $formatted_address = $data->results[0]->formatted_address;                    }         echo $formatted_address;        echo $status;        //$dbJobs->updateJob($aJob);           $action = 'update';    $uid = $_SESSION['userId'];    $loc = $_SESSION['location'];     }    // Get lattitude and longitude for either start or end of a job scan    if($action=='update'){                    $jobDdId = $aJob->getDBID();        // add code for javascript json to update the database    }    elseif ($action=='New') {        $theJobs = $dbJobs->getOpenJobsEmployeeLocation($_SESSION['userId'],$_SESSION['location']);        $aJob = $theJobs->getFirstIndexJob();        $jobDdId = $aJob->getDBID();    }unset($_SESSION['location']);unset($_SESSION['pass']);}$title = 'Longo Corporation - Log Start/Stop Time';$description = '';$keywords = '';printHeadLog($title, $description, $keywords);printHeaderLog();?><!-- ==============================content================================ --><script src="../js/jquery.js"></script><script>$(document).ready(function(){        $('#sublogOut').click(function(){        if($('#cmt').val() != ''){            submitcomment();        }        else{            alert("Please input your comment. Your time would not be recorded without your comments.");            return false;        }             });        function submitcomment(){        var comments = $("#cmt").val();        var userid = "<?php print $uid; ?>";        var location = "<?php print $loc; ?>";        var lat = "<?php print $latitudeAD; ?>";        var lng = "<?php print $latitudeAD; ?>";        var format = "<?php print $formatted_address; ?>";                $.ajax({             type: "post",             url: "updateJobComment.php",                                                             data: { iscomment:"commentupdate", comments:comments, userid:userid, location:location, lat:lat, lng:lng, format:format},             success: function(data){                 $("#submit").prop('disabled', true);                 $('#cmt').attr('readonly','readonly');                 $(".comment-msg").html(data);                 $(".comment-msg").delay(3000).fadeOut(400);                 $("#submit").val("Checked Out Successfully");                 window.location.href = "../php/logout.php?context=admin";             }        });    }    });</script><section id="content">    <div class="container_12">    </div>    <div class="aside">        <div class="container_12">	            <div class="grid_12">                                <div id="map"></div>                <h2>                <?php                    if($action=='New'){                        print 'Start Time Logged';                    }                    else{                        print 'End Time Logged';                    }                ?>                </h2>                                <p>                </p>                                    <b>Employee Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b> <?php print $_SESSION['employeeName'];?>                <p>                    <b>Location Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b> <?php print $locationName;?>                </p>                <p>                    <b>Start Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b> <?php print $aJob->getDisplayStartTime();?>                </p>                <p>                    <b>End Time:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <?php                         if($action=='update'){                                                                                print $aJob->getDisplayEndTime();                            print '</p>';                            print '<p><b>Total Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>';                            print $aJob->getDuration();                                                        //code by plego                            ?>                                <br />                                    <b>Comment:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </b>                                    <textarea id="cmt" placeholder="Leave Your Comment Here" cols="30" rows="10"></textarea>                                <br />                                                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                    <span class="comment-msg"> </span>                                                                                                    <br />                                                           <?php                                                                                //code by plego                                                    }                        else{                            print 'N/A';                        }                    ?>                </p>                                <br />                                    <p class='errdenied'></p>                                <br />                                <br />                                              <a id='vtl' href="../admin/" class="button">View Time Logs</a>                <br />                <br />                				<?php if($action=='New'){ ?>									<a id="logOut" href="../php/logout.php?context=admin" class="button"> Log Out </a>								<?php } else{ ?>                                                   <a id="sublogOut" href="#" class="button"> Submit and Log Out </a>                    									<?php } ?>                                         </div>            <div class="clear"></div>        </div>    </div>  </section> <?php printFooter();?>